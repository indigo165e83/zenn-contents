---
title: "Next.jsã§Playwrightã‚’ä½¿ã£ã¦ã¿ã‚‹"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Nextjs","playwright"]
published: false
---
# Next.jsã§Playwrightã‚’ä½¿ã£ã¦ã¿ã‚‹
Playwrightã§ã©ã‚“ãªãƒ†ã‚¹ãƒˆãŒã§ãã‚‹ã‹å®Ÿé¨“

## ç’°å¢ƒæ§‹ç¯‰

### 0 å‰æ

Node.js 18 ä»¥ä¸Šæ¨å¥¨ï¼ˆ20 ãªã‚‰ãªãŠè‰¯ã—ï¼‰

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã¯ãŠå¥½ã¿ã§ï¼ˆnpm / pnpm / yarnï¼‰ã€‚ä»¥ä¸‹ã¯ npm ä¾‹ã§æ›¸ãã¾ã™ã€‚

### 1 Next.js ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆï¼ˆæœªä½œæˆãªã‚‰ï¼‰
```bash
# æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
npx create-next-app@latest nextjs-playwright-01 --ts --eslint
cd nextjs-playwright-01
```

æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãªã‚‰ã€ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ«ãƒ¼ãƒˆã¸ç§»å‹•ã™ã‚‹ã ã‘ã§OKã€‚

### 2 Playwright ã®å°å…¥ï¼ˆE2E ãƒ†ã‚¹ãƒˆï¼‰
```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›´ä¸‹ã§
npm create playwright@latest
# ? Where to put your end-to-end tests? Â· tests
# ? Add a GitHub Actions workflow? (Y/n) Â· true
# ? Install Playwright operating system dependencies (requires sudo / root - can be done manually via 'sudo npx playwright install-deps')? (y/N) Â· false
```

ã“ã‚Œã§ä»¥ä¸‹ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼š
- playwright.config.ts
- tests/ï¼ˆã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚¹ãƒˆï¼‰
- .github/workflows/playwright.ymlï¼ˆé¸ã‚“ã å ´åˆï¼‰

ã™ã§ã« playwright ãŒå…¥ã£ã¦ã„ã‚‹å ´åˆã§ã‚‚ã€è¨­å®šã ã‘å–ã‚Šè¾¼ã‚ã¾ã™ã€‚

### 3 æœ€åˆã® E2E ãƒ†ã‚¹ãƒˆï¼ˆApp Router å‰æï¼‰
```TypeScript
import { test, expect } from '@playwright/test';

test('ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹', async ({ page }) => {
  await page.goto('http://localhost:3000/');
  //await expect(page.getByRole('heading', { level: 1 })).toBeVisible();   // <h1>ãŒè¦‹ãˆã‚‹
  await expect(page).toHaveTitle(/Create Next App/);                     // ã‚¿ã‚¤ãƒˆãƒ«
});

test('Learnãƒªãƒ³ã‚¯ãŒå­˜åœ¨ã—ã€ã‚¯ãƒªãƒƒã‚¯ã§ãã‚‹', async ({ page }) => {
  await page.goto('http://localhost:3000/');
  const learnLink = page.getByRole('link', { name: 'Learn' });
  await expect(learnLink).toBeVisible();  // è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹
  await expect(learnLink).toHaveAttribute('href', /^https:\/\/nextjs\.org\/learn(?:\?.*)?$/); // hrefç¢ºèª
});

test('Learnãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å¤–éƒ¨ãƒšãƒ¼ã‚¸ãŒé–‹ã', async ({ page }) => {
  await page.goto('http://localhost:3000/');

  const [newPage] = await Promise.all([
    page.waitForEvent('popup'), // æ–°ã—ã„ã‚¿ãƒ–ï¼ˆã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰ã‚’å¾…ã¤
    page.getByRole('link', { name: 'Learn' }).click(),
  ]);

  await newPage.waitForLoadState(); // ãƒ­ãƒ¼ãƒ‰å®Œäº†ã‚’å¾…ã¤
  await expect(newPage).toHaveURL(/https:\/\/nextjs\.org\/learn(?:\?.*)?$/); // æ–°ã—ã„ã‚¿ãƒ–ã®URLã‚’ç¢ºèª
});
```
ã‚»ãƒ¬ã‚¯ã‚¿ã¯ Roleãƒ™ãƒ¼ã‚¹ï¼ˆgetByRoleï¼‰ã‹ ãƒ†ã‚¹ãƒˆIDï¼ˆdata-testidï¼‰æ¨å¥¨ã€‚UIå¤‰æ›´ã«å¼·ã„ã§ã™ã€‚